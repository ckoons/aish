#!/usr/bin/env python3
"""
aish - The AI Shell
Main entry point for the AI shell interpreter.
"""

import sys
import os
import argparse
from pathlib import Path

# Add src to path
sys.path.insert(0, os.path.join(os.path.dirname(__file__), 'src'))

from core.shell import AIShell
from core.version import __version__

def main():
    parser = argparse.ArgumentParser(
        description='aish - The AI Shell',
        epilog='AIs are just sockets. They read input, write output.'
    )
    
    parser.add_argument(
        'script',
        nargs='?',
        help='AI script to execute'
    )
    
    parser.add_argument(
        '-c', '--command',
        help='Execute a single command and exit'
    )
    
    parser.add_argument(
        '-v', '--version',
        action='version',
        version=f'aish {__version__}'
    )
    
    parser.add_argument(
        '-d', '--debug',
        action='store_true',
        help='Enable debug output'
    )
    
    parser.add_argument(
        '-r', '--rhetor',
        default=None,
        help='Rhetor endpoint (default: TEKTON_RHETOR_PORT env var or http://localhost:8003)'
    )
    
    args = parser.parse_args()
    
    # Create shell instance
    shell = AIShell(
        rhetor_endpoint=args.rhetor,
        debug=args.debug
    )
    
    # Execute based on mode
    if args.command:
        # Single command mode
        shell.execute_command(args.command)
    elif args.script:
        # Script execution mode
        shell.execute_script(args.script)
    else:
        # Interactive mode
        shell.interactive()

if __name__ == '__main__':
    main()